<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Shop S·∫£n Ph·∫©m</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/home.css') }}"
    />
  </head>

  <body>
    <!-- Navbar -->
    <nav>
      <div class="logo">MHTHM</div>
      <div class="menu">
        <a href="/">Trang ch·ªß</a>
        <a href="{{ url_for('product_info_bp.product_info') }}">S·∫£n ph·∫©m</a>
        <a href="#">Khuy·∫øn m√£i</a>
        <a href="{{ url_for('contact_bp.contact') }}">Li√™n h·ªá</a>
      </div>
      <div class="cart">
        <a
          href="{{ url_for('cart_bp.cart') }}"
          style="text-decoration: none; color: white"
          >üõí Gi·ªè h√†ng</a
        >
      </div>

      {% if session.get('user_name') %}
      <div class="user-info">
        üë§ {{ session['user_name'] }}
        <a href="{{ url_for('auth_bp.logout') }}" class="logout-btn"
          >ƒêƒÉng xu·∫•t</a
        >
      </div>
      {% else %}
      <a href="{{ url_for('auth_bp.auth') }}" class="login-btn">üîê ƒêƒÉng nh·∫≠p</a>
      {% endif %}
    </nav>

    <!-- üîé Search -->
    <section class="search-section">
      <form action="{{ url_for('home_bp.search') }}" method="get">
        <input
          type="text"
          name="q"
          id="searchInput"
          placeholder="T√¨m s·∫£n ph·∫©m..."
          value="{{ keyword or '' }}"
        />
        <button type="submit">T√¨m</button>
      </form>
    </section>

    {% if search_results is not none %}
    <section class="category" id="searchResults">
      <h2>
        {% if keyword %} K·∫øt qu·∫£ t√¨m ki·∫øm cho "{{ keyword }}" {% else %} K·∫øt qu·∫£
        t√¨m ki·∫øm {% endif %}
      </h2>
      <div class="scroll-x" id="productsContainer">
        {% if search_results %} {% for p in search_results %}
        <div
          class="product-card"
          onclick="location.href='{{ url_for('product_bp.product_detail', id=p.id) }}'"
        >
          <img
            src="{{ url_for('static', filename=p.image_url|string) }}"
            alt="{{ p.name }}"
          />
          <div class="product-name">{{ p.name }}</div>
          <div class="product-price">{{ "{:,.0f}".format(p.price) }} VND</div>
          <a
            href="{{ url_for('product_bp.product_detail', id=p.id) }}"
            class="view-btn"
            >Xem chi ti·∫øt</a
          >
        </div>
        {% endfor %} {% else %}
        <p class="no-result">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m ph√π h·ª£p.</p>
        {% endif %}
      </div>
    </section>
    {% endif %} {% if search_results is none %}
    <section class="category" id="iphoneSection">
      <h2>iPhone</h2>
      <div class="scroll-x">
        {% for p in iphones %}
        <div
          class="product-card"
          onclick="location.href='{{ url_for('product_bp.product_detail', id=p.id) }}'"
        >
          <img
            src="{{ url_for('static', filename=p.image_url|string) }}"
            alt="{{ p.name }}"
          />
          <div class="product-name">{{ p.name }}</div>
          <div class="product-price">{{ "{:,.0f}".format(p.price) }} VND</div>
          <a
            href="{{ url_for('product_bp.product_detail', id=p.id) }}"
            class="view-btn"
            >Xem chi ti·∫øt</a
          >
        </div>
        {% else %}
        <p style="text-align: center; color: gray">Kh√¥ng c√≥ s·∫£n ph·∫©m iPhone.</p>
        {% endfor %}
      </div>
    </section>

    <section class="category" id="samsungSection">
      <h2>Samsung</h2>
      <div class="scroll-x">
        {% for p in samsungs %}
        <div
          class="product-card"
          onclick="location.href='{{ url_for('product_bp.product_detail', id=p.id) }}'"
        >
          <img
            src="{{ url_for('static', filename=p.image_url|string) }}"
            alt="{{ p.name }}"
          />
          <div class="product-name">{{ p.name }}</div>
          <div class="product-price">{{ "{:,.0f}".format(p.price) }} VND</div>
          <a
            href="{{ url_for('product_bp.product_detail', id=p.id) }}"
            class="view-btn"
            >Xem chi ti·∫øt</a
          >
        </div>
        {% else %}
        <p style="text-align: center; color: gray">
          Kh√¥ng c√≥ s·∫£n ph·∫©m Samsung.
        </p>
        {% endfor %}
      </div>
    </section>

    <section class="category" id="laptopSection">
      <h2>Laptop</h2>
      <div class="scroll-x">
        {% for p in laptops %}
        <div
          class="product-card"
          onclick="location.href='{{ url_for('product_bp.product_detail', id=p.id) }}'"
        >
          <img
            src="{{ url_for('static', filename=p.image_url|string) }}"
            alt="{{ p.name }}"
          />
          <div class="product-name">{{ p.name }}</div>
          <div class="product-price">{{ "{:,.0f}".format(p.price) }} VND</div>
          <a
            href="{{ url_for('product_bp.product_detail', id=p.id) }}"
            class="view-btn"
            >Xem chi ti·∫øt</a
          >
        </div>
        {% else %}
        <p style="text-align: center; color: gray">Kh√¥ng c√≥ s·∫£n ph·∫©m Laptop.</p>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!--  Chat -->
    <div id="chat-bubble" class="chat-bubble">
      <img
        src="{{ url_for('static', filename='images/ai.png') }}"
        alt="Chatbot"
        style="width: 45px; height: 45px"
      />
    </div>

    <div id="chat-box" class="chat-box hidden">
      <div class="chat-header">Tr·ª£ l√Ω MHTHM</div>
      <div class="chat-messages" id="chat-messages">
        <p>Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay?</p>
      </div>
      <form class="chat-input">
        <input
          type="text"
          name="message"
          placeholder="Nh·∫≠p tin nh·∫Øn..."
          required
        />
        <button type="submit">G·ª≠i</button>
      </form>
    </div>

    <script>
      // ƒê√≥ng , m·ªü khung chat
      const bubble = document.getElementById("chat-bubble");
      const box = document.getElementById("chat-box");
      bubble.addEventListener("click", () => {
        box.classList.toggle("hidden");
      });

      // G·ª≠i tin nh·∫Øn kh√¥ng reload
      const form = document.querySelector(".chat-input");
      const input = form.querySelector("input[name='message']");
      const messagesDiv = document.getElementById("chat-messages");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const msg = input.value.trim();
        if (!msg) return;

        messagesDiv.innerHTML += `<p><b>B·∫°n:</b> ${msg}</p>`;
        input.value = "";

        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg }),
        });

        const data = await res.json();
        messagesDiv.innerHTML += `<p><b>Bot:</b> ${data.reply}</p>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      });
    </script>
  </body>
</html>
